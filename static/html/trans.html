<h2 class="page-header">Meta Checker</h2>
<div id="trans" class="row">
    <div class="col-md-4 navslid trans-side navslid-show">
        <p>
            URL Import(.txt only)
        </p>
        <div class="input-group">
            <input class="form-control" type="file" id="fileInput">
            <span class="input-group-btn">
             <input type="button" class="btn btn-primary" value="Import" id="btnImport"/>
              </span>
        </div>

        <p>URL Input</p>
        <p>(eg:https://www.apple.com/cn/iphone)</p>
        <p>
            <textarea rows="5" id="urls" class="form-control"></textarea>
        </p>

        <button id="btnQuest" class="btn btn-primary">Query</button>
        <button id="btnClear" class="btn btn-primary">Clear</button>
    </div>
    <div>
        <button class="sideIcon">&lt;</button>
    </div>
    <div class="col-md-7 showValue">
        <p class="col-md-4">
            <label>
                <input type="radio" name="optionsRadios" id="rdExcel" value="excel" checked>
                Excel
            </label>
            <label>
                <input type="radio" name="optionsRadios" id="rdHTML" value="html">
                HTML
            </label>
        </p>
        <p class="col-md-4 exbutton">
            <button id="btnExport" class="btn btn-primary">Export</button>
        </p>
    </div>
    <div class="col-md-7 showValue">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>URL</th>
                <th>Title</th>
                <th>Description</th>
                <th>OG Title</th>
                <th>OG Description</th>
                <th>OG Img</th>
                <th>OG Img URL</th>
                <th>WeChat Img</th>
                <th>WeChat URL</th>
            </tr>
            </thead>
            <tbody id="resContainer" class="metaStyle">
            </tbody>
        </table>
    </div>
</div>

<script>
    //const fileInput = $("#fileInput");
    // const urlInput = $("#urls");
    // const resContainer = $('#resContainer');
    var storedData;

    $("#btnImport").click(() => {
        if ($("#fileInput")[0].files.length >= 1) {
            const file = $("#fileInput")[0].files[0];
            let reader = new FileReader();
            reader.onload = function () {
                $("#urls").val(this.result);
                $("#fileInput").val("");
            };
            reader.readAsText(file);
        }
    });
    $('#btnClear').click(() => {
        $("#urls").val('');
    });
    $('#btnQuest').click(() => {
        if ($("#urls").val().length > 5) {
            $('#resContainer').html('');
            $.post('/api/trans', {urls: $("#urls").val()}, function (data) {
                if (data) {
                    storedData = data;
                    let str = '';
                    data.forEach((item, index) => {
                        str += `<tr>
                                    <td><ul><li><a href="${item.url}" target="_blank">${item.url}</a></li></ul></td>

                                    <td><ul><li>${item.title}</li></ul></td>

                                    <td${item.desc&&(item.desc.length > 150||item.desc.length<100) ? " class='red'" : ""}><ul><li>${item.desc}</li></ul></td>

                                    <td><ul><li>${item.ogTitle}</li></ul></td>

                                    <td${item.ogDesc&&(item.ogDesc.length > 150 || item.ogDesc.length < 100) ? " class='red'" : ""}><ul><li>${item.ogDesc}</li></ul></td>

                                    <td class="text-center"><ul><li><img src="${item.ogImage.url}" alt="ogImage" class="ext-thumb"><br>
                                     Width:${item.ogImage.size.width}.Hight:${item.ogImage.size.height}</li></ul></td>

                                    <td><ul><li><a href="${item.ogImage.url}" target="_blank">${item.ogImage.url}</a></li></ul> </td>

                                    <td class="text-center"><ul><li><img src="${item.wechat.url}" alt="wachatImage" class="ext-thumb"><br>
                                      Width:${item.wechat.size.width}.Hight:${item.wechat.size.height}</li></ul> </td>

                                    <td><ul><li><a href="${item.wechat.url}" target="_blank">${item.wechat.url}</a></li></ul></td>
                                </tr>`
                    });
                    $('#resContainer').html(str);
                }
            });
        } else {
            console.log("null");
        }
    });
    $("#btnExport").click(() => {
        if ($("#urls").val().length > 0) {
            const arr = $("#resContainer").text();
            console.log(storedData);
            $.post(`/api/trans/export/${document.querySelector("input[name=optionsRadios]:checked").value}`, {
                    xls: JSON.stringify(storedData)
                },
                (data) => {
                    $.fileDownload(`/api/files/${data}`);
                })
        }
    })
    $(".sideIcon").click(()=> {
        if ($(".trans-side").hasClass("navslid-hide")) {
            $(".trans-side").addClass("navslid-show");
            $(".trans-side").removeClass("navslid-hide");

        }
        else if ($(".trans-side").hasClass("navslid-show")) {
            $(".trans-side").addClass("navslid-hide");
            $(".trans-side").removeClass("navslid-show");
        }
        else {
            $(".trans-side").addClass("navslid-hide");
        }
    });
</script>