<h2 class="page-header">Translation Helper</h2>
<div id="trans" class="row">
    <div class="col-md-4">
        <p>
            URL Import(.txt only)
        </p>
        <div class="input-group">
            <input class="form-control" type="file" id="fileInput">

            <span class="input-group-btn">
    <input type="button" class="btn btn-primary" value="Import" id="btnImport"/>
</span>
        </div>

        <p>URL Input</p>
        <p>
            <textarea rows="5" id="urls" class="form-control"></textarea>
        </p>

        <button id="btnQuest" class="btn btn-primary">Query</button>
        <button id="btnClear" class="btn btn-primary">Clear</button>
    </div>
    <div class="col-md-8">
        <p>
            <label>
                <input type="radio" name="optionsRadios" id="rdExcel" value="excel" checked>
                Excel
            </label>
            <label>
                <input type="radio" name="optionsRadios" id="rdHTML" value="html">
                HTML
            </label>
        </p>
        <p>
            <button id="btnExport" v-on:click="getExcel" class="btn btn-primary">Export</button>
            <a v-bind:href="excelUrl" target="_blank">{{excelName}}</a>
        </p>

        <table class="table table-striped table-bordered">
            <tr>
                <th>URL</th>
                <th>Description</th>
                <th>OG Description</th>
                <th>Title</th>
                <th>OG Title</th>
            </tr>
            <tbody id="resContainer">
            </tbody>
        </table>
    </div>
</div>

<script>
    const fileInput = $("#fileInput");
    const urlInput = $("#urls");
    const resContainer = $('#resContainer');

    $("#btnImport").click(() => {
        if (fileInput[0].files.length >= 1) {
            const file = fileInput[0].files[0];
            let reader = new FileReader();
            reader.onload = function () {
                urlInput.val(this.result);
                fileInput.val("");
            };
            reader.readAsText(file);
        }
    });

    $('#btnClear').click(() => {
        urlInput.val('');
    });

    $('#btnQuest').click(() => {
        if (urlInput.val().length > 5) {
            resContainer.html('');
            $.post('/api/trans', {urls: urlInput.val()}, function (data) {
                if (data) {
                    let str = '';
                    data.forEach((item, index) => {
                        str += `<tr>
                                    <td><a href="${item.url}" target="_blank">${item.url}</a></td>
                                    <td class="${ item.desc.length > 150 ? 'red' : '' }">${item.desc}</td>
                                    <td class="${ item.desc.length > 150 ? 'red' : '' }">${item.ogDesc}</td>
                                    <td>${item.title}</td>
                                    <td>${item.ogTitle}</td>
                                </tr>`
                    });
                    resContainer.html(str);
                }
            });
        } else {
            console.log("null");
        }
    });

    //            getExcel: function () {
    //                if (this.arr.length > 0) {
    //                    var that = this;
    //                    $.post('/api/trans2xls', {
    //                        xls: JSON.stringify(this.arr),
    //                        type: document.querySelector("input[name=optionsRadios]:checked").value
    //                    }, function (data) {
    //                        console.log(data);
    //                        that.excelName = data;
    //                        that.excelUrl = `../data/${data}`;
    //                    });
    //                } else {
    //                    console.log('cant');
    //                }
    //            },
    //            importTxt: function () {
    //                var that = this;
    //                var fileInput = document.querySelector("#fileInput");
    //                if (fileInput.files.length >= 1) {
    //                    var file = document.querySelector("#fileInput").files[0];
    //                    var reader = new FileReader();
    //                    reader.onload = function () {
    //                        console.log(this.result);
    //                        that.urls += this.result;
    //                        fileInput.value = "";
    //                    };
    //                    reader.readAsText(file);
    //                }
    //            },
</script>